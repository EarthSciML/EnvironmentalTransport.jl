using EnvironmentalTransport

using Test

c = [0.0, 1, 2, 3, 4, 5]
v = [10.0, 8, 6, 4, 2, 0, 1]
nz = 6
Δt = 0.05
Δz = 0.5

result = advect1d_l94(c, v, nz, Δt, Δz)

@test result ≈ [0.0, 0.28, 1.8, 3.24, 4.68, 4.5]

result = advect1d_ppm(c, v, nz, Δt, Δz)

@test result ≈ [0.0, 0.3999999999999999, 1.8, 3.2, 4.6, 4.5]

c = [6.0, 6, 5, 5, 6, 6]
v = [2.0, 2, 2, 2, 2, 2, 2]

result = advect1d_l94(c, v, nz, Δt, Δz)

@test result ≈ [6.0, 6.0, 5.2, 5.0, 5.8, 6.0]

result = advect1d_ppm(c, v, nz, Δt, Δz)

@test result ≈ [6.0, 6.0, 5.2, 5.0, 5.8, 6.0]

u = repeat([10.0, 8, 6, 4, 5, 7]', 6, 1)
v = repeat([0.0, 2, 4, 6, 4, 2], 1, 6)
c = collect(reshape(1.0:36, 6, 6))
Δt = 10
lons = -90:30:60
lats = -70:30:80

c_out = advect2D(Δt, 6, 6, c, u, v, lons, lats, advect1d_l94)

@test c_out ≈
      [1.0 7.0 13.999912450096401 25.999693571370603 37.99955348934023 49.99967604998771;
       2.0 8.0 15.999921821263404 27.999884685400875 39.999794779532905 51.99985145729861;
       3.999977541747584 15.999880222280167 31.999619693026514 55.999295677173016 79.99893612766996 103.99888463232463;
       5.999985027757 17.999992513766415 35.999806764578324 59.99979751476569 83.99962191087576 107.99972274325185;
       8.000005988825466 20.000041922208666 39.9998022764625 63.99993591497165 87.99975416439449 111.99995830606255;
       10.000007486081149 22.00002545277275 43.998942938157086 67.9994332333068 91.99854703869957 115.99902577412198]

c = collect(reshape(1.0:36, 6, 6))

c_out = advect2D(Δt, 6, 6, c, u, v, lons, lats, advect1d_l94)

@test c_out ≈
      [1.0 7.0 13.999912450096401 25.999693571370603 37.99955348934023 49.99967604998771;
       2.0 8.0 15.999921821263404 27.999884685400875 39.999794779532905 51.99985145729861;
       3.999977541747584 15.999880222280167 31.999619693026514 55.999295677173016 79.99893612766996 103.99888463232463;
       5.999985027757 17.999992513766415 35.999806764578324 59.99979751476569 83.99962191087576 107.99972274325185;
       8.000005988825466 20.000041922208666 39.9998022764625 63.99993591497165 87.99975416439449 111.99995830606255;
       10.000007486081149 22.00002545277275 43.998942938157086 67.9994332333068 91.99854703869957 115.99902577412198]
